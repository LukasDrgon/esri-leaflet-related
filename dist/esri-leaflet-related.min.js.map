{"version":3,"file":"esri-leaflet-related.min.js","sources":["esri-leaflet-related.js"],"names":["Esri","window","L","esri","EsriLeafletRelated","Tasks","Task","extend","setters","offset","limit","outFields","objectIds","relationshipId","definitionExpression","precision","featureIds","returnGeometry","returnZ","returnM","token","path","params","outSr","simplify","map","factor","mapWidth","Math","abs","getBounds","getWest","getEast","this","maxAllowableOffset","getSize","y","run","callback","context","request","error","response","result","features","i","relatedRecordGroups","length","k","relatedRecords","push","call","Util","responseToFeatureCollection","layer","QueryRelated","queryRelated"],"mappings":";;;;;;;;AAKA,IAAKA,KACH,GAAIA,MAAOC,OAAOC,EAAEC,IAGtBC,oBAAqBJ,KAAKK,MAAMC,KAAKC,QACnCC,SACEC,OAAU,SACVC,MAAS,QACTC,UAAa,SACbC,UAAa,YACbC,eAAkB,iBAClBC,qBAAwB,uBACxBC,UAAa,oBACbC,WAAc,YACdC,eAAkB,iBAClBC,QAAW,UACXC,QAAW,UACXC,MAAS,SAGXC,KAAM,sBAENC,QACEL,gBAAgB,EAChBM,MAAO,KACPZ,UAAW,IACXO,SAAS,EACTC,SAAS,GAKXK,SAAU,SAASC,EAAKC,GACtB,GAAIC,GAAWC,KAAKC,IAAIJ,EAAIK,YAAYC,UAAYN,EAAIK,YAAYE,UAEpE,OADAC,MAAKX,OAAOY,mBAAsBP,EAAWF,EAAIU,UAAUC,EAAKV,EACzDO,MAGTI,IAAK,SAASC,EAAUC,GACtB,MAAON,MAAKO,QAAQ,SAASC,EAAOC,GAKlC,IAAK,GAHDC,IACFC,aAEOC,EAAI,EAAGA,EAAIH,EAASI,oBAAoBC,OAAQF,IACvD,IAAK,GAAIG,GAAI,EAAGA,EAAIN,EAASI,oBAAoBD,GAAGI,eAAeF,OAAQC,IACzEL,EAAOC,SAASM,KAAKR,EAASI,oBAAoBD,GAAGI,eAAeD,GAGxEV,GAASa,KAAKZ,EAASE,EAAQC,GAAYxC,EAAEC,KAAKiD,KAAKC,4BAA4BV,GAAUD,IAC5FH,IAGLe,MAAO,SAASA,GAEd,MADArB,MAAKZ,KAAOiC,EAAQ,uBACbrB,QAKW,mBAAXhC,SAA0BA,OAAOC,GAAKD,OAAOC,EAAEC,OACxDF,OAAOC,EAAEC,KAAKE,MAAMkD,aAAenD,mBAEnCJ,KAAKK,MAAMmD,aAAe,SAASlC,GACjC,MAAO,IAAIlB,oBAAmBkB","sourcesContent":["/*! esri-leaflet-related - v0.0.1-beta.2 - 2015-03-08\n*   Copyright (c) 2015 Environmental Systems Research Institute, Inc.\n*   Apache 2.0 License */\n\n// We do not have an 'Esri' variable e.g loading this file directly from source define 'Esri'\nif (!Esri) {\n  var Esri = window.L.esri;\n}\n\nEsriLeafletRelated = Esri.Tasks.Task.extend({\n  setters: {\n    'offset': 'offset',\n    'limit': 'limit',\n    'outFields': 'fields',\n    'objectIds': 'objectIds',\n    'relationshipId': 'relationshipId',\n    'definitionExpression': 'definitionExpression',\n    'precision': 'geometryPrecision',\n    'featureIds': 'objectIds',\n    'returnGeometry': 'returnGeometry',\n    'returnZ': 'returnZ',\n    'returnM': 'returnM',\n    'token': 'token'\n  },\n\n  path: 'queryRelatedRecords',\n\n  params: {\n    returnGeometry: true,\n    outSr: 4326,\n    outFields: '*',\n    returnZ: true,\n    returnM: false\n  },\n\n  //http://resources.arcgis.com/en/help/arcgis-rest-api/#/Query_Related_Records/02r300000115000000/\n\n  simplify: function(map, factor) {\n    var mapWidth = Math.abs(map.getBounds().getWest() - map.getBounds().getEast());\n    this.params.maxAllowableOffset = (mapWidth / map.getSize().y) * factor;\n    return this;\n  },\n\n  run: function(callback, context) {\n    return this.request(function(error, response) {\n      //if more than one objectId is specified, we loop through the features and pass a single collection to the utility method which converts to geoJson\n      var result = {\n        'features': []\n      };\n      for (var i = 0; i < response.relatedRecordGroups.length; i++) {\n        for (var k = 0; k < response.relatedRecordGroups[i].relatedRecords.length; k++) {\n          result.features.push(response.relatedRecordGroups[i].relatedRecords[k]);\n        }\n      }\n      callback.call(context, error, (response && L.esri.Util.responseToFeatureCollection(result)), response);\n    }, context);\n  },\n\n  layer: function(layer) {\n    this.path = layer + '/queryRelatedRecords';\n    return this;\n  }\n});\n\n// attach to the L.esri global if we can\nif (typeof window !== 'undefined' && window.L && window.L.esri) {\n  window.L.esri.Tasks.QueryRelated = EsriLeafletRelated;\n\n  Esri.Tasks.queryRelated = function(params) {\n    return new EsriLeafletRelated(params);\n  };\n}"]}